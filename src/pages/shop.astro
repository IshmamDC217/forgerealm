---
import BaseLayout from '../layouts/BaseLayout.astro';
import ShopNavbar from '../components/ShopNavbar';
import ShopHeroCTA from '../components/ShopHeroCTA';
import ShopShowcase from '../components/ShopShowcase';
import SignIn from '../components/SignIn';
import ShopGateHero from '../components/ShopGateHero';

const apiBase = import.meta.env.PUBLIC_API_URL ? import.meta.env.PUBLIC_API_URL.trim().replace(/\/$/, '') : '';
const apiLocal = import.meta.env.PUBLIC_API_URL_LOCAL ? import.meta.env.PUBLIC_API_URL_LOCAL.trim().replace(/\/$/, '') : '';
---

<BaseLayout title="Eco 3D Prints from Leeds | ForgeRealm Shop" description="Eco-friendly, micro-batch 3D prints from Leeds. Plant-based materials, low-VOC finishing, and plastic-free packaging.">
  <ShopNavbar client:load />

  <main
    class="relative isolate min-h-[100svh] bg-slate-950 text-white overflow-x-hidden"
    data-api-base={apiBase}
    data-api-local={apiLocal}
  >
    <div class="pointer-events-none absolute inset-0 -z-10">
      {/* Enhanced ambient lighting for shop */}
      <div class="absolute -left-32 -top-24 h-[480px] w-[480px] rounded-full bg-gradient-to-r from-blue-500/35 to-cyan-400/25 blur-[160px] animate-pulse" />
      <div class="absolute right-[-160px] top-10 h-[400px] w-[400px] rounded-full bg-gradient-to-r from-emerald-500/25 to-teal-400/20 blur-[180px] animate-pulse" style={{ animationDelay: '1s' }} />
      <div class="absolute top-1/2 left-1/3 h-72 w-72 rounded-full bg-gradient-to-r from-indigo-500/20 to-purple-400/15 blur-[130px] animate-pulse" style={{ animationDelay: '2s' }} />
      <div class="absolute bottom-1/4 right-1/4 h-56 w-56 rounded-full bg-gradient-to-r from-fuchsia-500/15 to-pink-400/10 blur-[110px] animate-pulse" style={{ animationDelay: '0.5s' }} />

      {/* Enhanced radial gradients */}
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_20%_20%,rgba(59,130,246,0.10),transparent_40%),radial-gradient(circle_at_80%_0%,rgba(167,139,250,0.08),transparent_35%),radial-gradient(circle_at_50%_80%,rgba(16,185,129,0.10),transparent_45%),radial-gradient(circle_at_70%_50%,rgba(6,182,212,0.06),transparent_35%)]" />

      {/* Floating particles for shop */}
      <div class="absolute inset-0 overflow-hidden">
        {Array.from({ length: 20 }, (_, i) => (
          <div
            key={i}
            class="absolute w-1 h-1 bg-emerald-400/40 rounded-full animate-bounce"
            style={{
              left: `${Math.random() * 100}%`,
              top: `${Math.random() * 100}%`,
              animationDelay: `${Math.random() * 4}s`,
              animationDuration: `${3 + Math.random() * 3}s`
            }}
          />
        ))}
      </div>
    </div>

    <section id="shop-gate" class="fixed inset-0 z-20 flex items-start overflow-y-auto bg-slate-950/95 px-6 sm:px-10 py-12 lg:py-20 backdrop-blur">
      <div class="mx-auto w-full max-w-6xl">
        <div class="grid w-full gap-10 lg:grid-cols-[1fr_1fr] items-center">
          <div class="mx-auto w-full max-w-xl space-y-6 pt-6 sm:pt-0 lg:mx-0 lg:pr-4">
          <span class="mt-4 inline-flex items-center gap-2 rounded-full border border-white/20 bg-white/10 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.35em] text-blue-100 backdrop-blur shadow-[0_0_30px_rgba(59,130,246,0.25)] hover:border-blue-400/40 hover:bg-white/15 transition-all duration-300">
            Store locked
          </span>
          <div class="space-y-3">
            <h1 class="text-4xl sm:text-5xl font-extrabold leading-tight drop-shadow-lg bg-clip-text text-transparent bg-gradient-to-r from-white via-blue-100 to-cyan-200">
              ForgeRealm Shop is <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-cyan-300 to-blue-500">coming soon</span>.
            </h1>
            <p class="max-w-xl text-lg text-slate-200/90">
              We are fine-tuning the drops, checkout, and live inventory. The full shop will open after testing is complete.
            </p>
          </div>
          <div class="grid gap-3 sm:grid-cols-2">
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4 text-xs uppercase tracking-[0.3em] text-blue-200/80 backdrop-blur">
              <p class="text-[11px] uppercase tracking-[0.3em] text-blue-200/80">Status</p>
              <p class="mt-2 text-sm font-semibold text-white">Preview only</p>
            </div>
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4 text-xs uppercase tracking-[0.3em] text-blue-200/80 backdrop-blur">
              <p class="text-[11px] uppercase tracking-[0.3em] text-blue-200/80">Launch</p>
              <p class="mt-2 text-sm font-semibold text-white">Store opening soon</p>
            </div>
          </div>
          <div class="rounded-2xl border border-white/10 bg-white/5 p-5 text-sm text-slate-200/90 backdrop-blur">
            <p class="text-[11px] uppercase tracking-[0.3em] text-blue-200/80">Launch updates</p>
            <p class="mt-2">
              Follow our socials for launch dates. Admins and partnered companies can sign in below to access the shop preview.
            </p>
          </div>
          <div class="flex flex-wrap items-center gap-3 text-xs uppercase tracking-[0.3em] text-blue-200/80">
            <span class="inline-flex items-center gap-2 rounded-full border border-white/15 bg-white/5 px-3 py-2">
              <span class="h-2 w-2 rounded-full bg-emerald-300" />
              Launching soon
            </span>
            <span class="inline-flex items-center gap-2 rounded-full border border-white/15 bg-white/5 px-3 py-2">
              <span class="h-2 w-2 rounded-full bg-indigo-300" />
              Come back shortly
            </span>
          </div>
          <div class="lg:hidden">
            <ShopGateHero client:load />
          </div>
          <div class="relative">
            <div class="absolute -inset-6 rounded-3xl border border-white/10 bg-white/5 blur-3xl" aria-hidden />
            <SignIn client:load />
          </div>
        </div>

          <div class="hidden lg:block lg:pl-4">
            <ShopGateHero client:load />
          </div>
        </div>
      </div>
    </section>

    <div id="shop-content" class="hidden">
      <header class="relative mx-auto max-w-6xl px-6 sm:px-10 pt-28 pb-16 lg:pt-32">
      <div class="grid items-center gap-12 lg:grid-cols-[1.05fr_0.95fr]">
        <div class="space-y-6">
          <span class="inline-flex items-center gap-2 rounded-full border border-white/15 bg-white/10 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.35em] text-blue-200 backdrop-blur">
            Leeds-built, Eco-first
          </span>
          <div class="space-y-3">
            <h1 class="text-4xl sm:text-5xl font-extrabold leading-tight drop-shadow-lg">
              Eco-grade 3D prints from Leeds, built to last.
            </h1>
            <p class="max-w-xl text-lg text-slate-200/90">
              Plant-based materials, low-VOC finishing, and plastic-free packaging. Click any piece to open its own window, study the finish, and lock in a build slot without losing your place.
            </p>
          </div>
          <div class="flex flex-wrap items-center gap-3">
            <a href="#products" class="inline-flex items-center gap-2 rounded-full bg-blue-500 px-5 py-3 text-sm font-semibold uppercase tracking-wide text-slate-950 shadow-lg shadow-blue-500/30 transition hover:-translate-y-[1px] hover:bg-blue-400">
              Browse builds
            </a>
            <a href="/shop/register" class="inline-flex items-center gap-2 rounded-full border border-white/20 bg-white/5 px-5 py-3 text-sm font-semibold uppercase tracking-wide text-white transition hover:-translate-y-[1px] hover:border-white/40 hover:bg-white/10">
              Custom print
            </a>
            <ShopHeroCTA client:load />
          </div>
          <div class="flex flex-wrap items-center gap-4 text-sm text-slate-200">
            <div class="inline-flex items-center gap-2 rounded-full border border-white/15 bg-white/5 px-3 py-2">
              <span class="h-2 w-2 rounded-full bg-blue-300" />
              Plant-based PLA+ and low-VOC finish
            </div>
            <div class="inline-flex items-center gap-2 rounded-full border border-white/15 bg-white/5 px-3 py-2">
              <span class="h-2 w-2 rounded-full bg-purple-300" />
              Tap to open product windows
            </div>
          </div>
        </div>

        <div class="relative">
          <div class="absolute -inset-6 rounded-3xl border border-white/10 bg-white/5 blur-3xl" aria-hidden />
          <div class="relative overflow-hidden rounded-3xl border border-white/10 bg-slate-900/60 shadow-2xl shadow-blue-500/20">
            <div class="absolute inset-0 bg-gradient-to-br from-white/5 via-blue-500/10 to-emerald-400/5" aria-hidden />
            <picture>
              <source srcset="/shop-assets/hero-banner-sm.webp" media="(max-width: 640px)" />
              <source srcset="/shop-assets/hero-banner-md.webp" media="(max-width: 768px)" />
              <source srcset="/shop-assets/hero-banner-lg.webp" media="(max-width: 1024px)" />
              <source srcset="/shop-assets/hero-banner-xl.webp" media="(max-width: 1280px)" />
              <source srcset="/shop-assets/hero-banner-2xl.webp" media="(min-width: 1281px)" />
              <img src="/shop-assets/hero.jpg" alt="ForgeRealm print desk" class="h-full w-full object-cover" loading="lazy" />
            </picture>
            <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-black/15 to-transparent" aria-hidden />
            <div class="absolute bottom-5 left-5 right-5 flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-white/15 bg-white/10 px-4 py-3 backdrop-blur">
              <div>
                <p class="text-[11px] uppercase tracking-[0.3em] text-blue-200">Live queue</p>
                <p class="text-sm text-slate-100">3 builds in print / 2 in finishing</p>
              </div>
              <div class="inline-flex items-center gap-2 rounded-full bg-emerald-500/20 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-emerald-100">
                Slots open
                <span class="h-2 w-2 rounded-full bg-emerald-300 animate-pulse" />
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-12 grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
        {[
          { title: 'Micro-batch crafted', detail: 'Limited drops with QA on every piece.' },
          { title: 'Eco materials', detail: 'Plant-based PLA+, low-VOC finishing.' },
          { title: 'Plastic-free wrap', detail: 'Recycled paper fill and starch tape.' },
          { title: 'Shipping worldwide', detail: 'Tracked, padded, and water-resistant.' }
        ].map((item) => (
          <div class="rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-slate-200 backdrop-blur">
            <p class="text-white font-semibold">{item.title}</p>
            <p class="text-slate-300 text-sm">{item.detail}</p>
          </div>
        ))}
      </div>
    </header>

      <ShopShowcase client:load />

      <section id="collections" class="relative border-t border-white/10 bg-slate-900/60 py-16">
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_20%,rgba(59,130,246,0.08),transparent_35%),radial-gradient(circle_at_70%_60%,rgba(59,130,246,0.05),transparent_40%)]" aria-hidden />
      <div class="relative mx-auto flex max-w-6xl flex-col gap-10 px-6 sm:px-10">
        <div class="flex items-center justify-between gap-4">
          <div>
            <p class="text-[11px] uppercase tracking-[0.35em] text-blue-200/80">Collections</p>
            <h2 class="text-3xl font-extrabold">Curated for every corner.</h2>
          </div>
          <a href="#products" class="text-sm uppercase tracking-wide text-blue-300 hover:text-white transition">
            Shop the drop
          </a>
        </div>
        <div class="grid gap-6 md:grid-cols-3">
          {[
            { title: 'Figurines', blurb: 'Dragons, owls, and guardians with paint-ready matte finishes.', cta: 'View minis' },
            { title: 'Lighting', blurb: 'Gradient lamps, halo orbs, and soft-bounce accent lighting.', cta: 'Light my desk' },
            { title: 'Accessories', blurb: 'Dice towers, stands, and everyday carry trays.', cta: 'Upgrade setup' }
          ].map((item) => (
            <article class="rounded-2xl border border-white/10 bg-white/5 p-6 backdrop-blur shadow-lg shadow-blue-500/10 transition hover:-translate-y-[2px] hover:border-blue-400">
              <div class="flex items-center justify-between">
                <h3 class="text-xl font-semibold text-white">{item.title}</h3>
                <span class="text-xs uppercase tracking-[0.3em] text-blue-200">Eco-ready</span>
              </div>
              <p class="mt-3 text-sm text-slate-300">{item.blurb}</p>
              <button class="mt-5 inline-flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-blue-200 hover:text-white transition">
                {item.cta}
                <span aria-hidden>-&gt;</span>
              </button>
            </article>
          ))}
        </div>

        <div class="grid gap-6 lg:grid-cols-[1.1fr_0.9fr]">
          <div class="rounded-2xl border border-white/10 bg-white/5 p-6 backdrop-blur shadow-inner shadow-blue-500/10">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-[11px] uppercase tracking-[0.3em] text-blue-200">Experience</p>
                <h3 class="text-xl font-semibold text-white">From print bed to your desk.</h3>
              </div>
              <span class="rounded-full bg-emerald-500/15 px-3 py-1 text-[11px] font-semibold uppercase tracking-wide text-emerald-100">
                Guided
              </span>
            </div>
            <div class="mt-4 grid gap-3 sm:grid-cols-3">
              {[
                { title: 'Print', detail: 'Slow profiles for crisp edges and zero ringing.' },
                { title: 'Finish', detail: 'Satin sanding, seam hiding, and water-based coat.' },
                { title: 'Ship', detail: 'Padded, waterproof, and plastic-free packaging.' }
              ].map((step) => (
                <div class="rounded-xl border border-white/10 bg-slate-900/70 px-4 py-3 text-sm text-slate-200">
                  <p class="text-white font-semibold">{step.title}</p>
                  <p class="text-slate-300 text-sm">{step.detail}</p>
                </div>
              ))}
            </div>
          </div>

          <div class="rounded-2xl border border-white/10 bg-gradient-to-br from-blue-600/20 via-indigo-500/20 to-slate-900/80 p-6 shadow-lg shadow-blue-500/20">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-[11px] uppercase tracking-[0.3em] text-blue-100">Promise</p>
                <h3 class="text-xl font-semibold text-white">Leeds-first 3D printing.</h3>
              </div>
              <span class="rounded-full bg-white/20 px-3 py-1 text-[11px] font-semibold uppercase tracking-wide text-white">
                Local quality
              </span>
            </div>
            <ul class="mt-4 space-y-2 text-sm text-slate-100">
              <li class="flex items-center gap-2">
                <span class="h-1.5 w-1.5 rounded-full bg-emerald-300" />
                Printed in Leeds with careful layer tuning for crisp edges.
              </li>
              <li class="flex items-center gap-2">
                <span class="h-1.5 w-1.5 rounded-full bg-blue-300" />
                Plant-based PLA and PETG options for everyday durability.
              </li>
              <li class="flex items-center gap-2">
                <span class="h-1.5 w-1.5 rounded-full bg-purple-300" />
                Small-batch runs with hands-on finishing for consistent detail.
              </li>
              <li class="flex items-center gap-2">
                <span class="h-1.5 w-1.5 rounded-full bg-amber-300" />
                Plastic-free packaging and careful QC before dispatch.
              </li>
            </ul>
          </div>
        </div>
      </div>
      </section>
    </div>
  </main>
</BaseLayout>

<script is:inline>
  const root = document.querySelector('main');
  const apiBase = root?.dataset.apiBase || '';
  const apiLocal = root?.dataset.apiLocal || '';
  const gate = document.getElementById('shop-gate');
  const content = document.getElementById('shop-content');
  const base =
    window.location.origin.startsWith('http://localhost')
      ? apiLocal || apiBase || ''
      : apiBase || apiLocal || '';
  const showContent = () => {
    if (content) {
      content.classList.remove('hidden');
      content.style.display = 'block';
      content.removeAttribute('aria-hidden');
    }
    if (gate) {
      gate.classList.add('hidden');
      gate.style.display = 'none';
      gate.setAttribute('aria-hidden', 'true');
    }
  };
  const showGate = () => {
    if (content) {
      content.classList.add('hidden');
      content.style.display = 'none';
      content.setAttribute('aria-hidden', 'true');
    }
    if (gate) {
      gate.classList.remove('hidden');
      gate.style.display = 'block';
      gate.removeAttribute('aria-hidden');
    }
  };
  const checkAuth = () => {
    const token = localStorage.getItem('forgerealm_admin_token');
    if (!token) {
      showGate();
      return;
    }
    if (!base) {
      showContent();
      return;
    }
    fetch(`${base}/api/auth/me`, {
      credentials: 'include',
      headers: { Authorization: `Bearer ${token}` },
    })
      .then((res) => {
        if (res.ok) {
          showContent();
        } else {
          localStorage.removeItem('forgerealm_admin_token');
          showGate();
        }
      })
      .catch(() => {
        showGate();
      });
  };
  checkAuth();
  window.addEventListener('forgerealm-admin-token-changed', checkAuth);
  window.addEventListener('storage', (event) => {
    if (event.key === 'forgerealm_admin_token') checkAuth();
  });
</script>
